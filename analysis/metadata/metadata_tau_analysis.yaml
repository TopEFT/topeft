scenario:
  name: tau_analysis
  description: Run-2 multilepton analysis with hadronic tau categories.
golden_jsons:
  '2016': data/goldenJsons/Cert_271036-284044_13TeV_Legacy2016_Collisions16_JSON.txt
  2016APV: data/goldenJsons/Cert_271036-284044_13TeV_Legacy2016_Collisions16_JSON.txt
  '2017': data/goldenJsons/Cert_294927-306462_13TeV_UL2017_Collisions17_GoldenJSON.txt
  '2018': data/goldenJsons/Cert_314472-325175_13TeV_Legacy2018_Collisions18_JSON.txt
  '2022': data/goldenJsons/Cert_Collisions2022_355100_362760_Golden.txt
  '2023': data/goldenJsons/Cert_Collisions2023_366442_370790_Golden.txt
channels:
  groups:
    TAU_CH_LST_SR:
      description: Signal regions enhanced with hadronic tau selections. Extends the
        baseline categories with dedicated tau-enriched bins.
      features:
      - requires_tau
      scenarios:
      - tau_analysis
      regions:
      - lepton_category: 2lss
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2lss_p
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - bmask_atmost2m
          - 0tau
        - name: 2lss_m
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - bmask_atmost2m
          - 0tau
        - name: 2lss_4t_p
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - bmask_atleast3m
          - 0tau
        - name: 2lss_4t_m
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - bmask_atleast3m
          - 0tau
        jet_bins:
        - =4
        - =5
        - =6
        - '>7'
        histogram_variables:
          exclude:
          - ptz
          - ptz_wtau
          - tau0pt
        application_tags:
          mc:
          - isSR_2lSS
          - isAR_2lSS
          data:
          - isAR_2lSS_OS
      - lepton_category: 2lss_1tau
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2lss_m_1tau_onZ
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - 1tau
          - onZ_tau
        - name: 2lss_p_1tau_offZ
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - 1tau
          - offZ_tau
        - name: 2lss_m_1tau_offZ
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - 1tau
          - offZ_tau
        - name: 2lss_p_1tau_onZ
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - 1tau
          - onZ_tau
        jet_bins:
        - =3
        - =4
        - =5
        - '>6'
        histogram_variables:
          exclude:
          - ptz
        application_tags:
          mc:
          - isSR_2lSS
          - isAR_2lSS
          data:
          - isAR_2lSS_OS
      - lepton_category: 2los_1tau
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2los_onZ_1tau
          channel: 2los
          tags:
          - bmask_atleast2m
          - 1tau
          - 2l_onZ
        jet_bins:
        - '>5'
        application_tags:
          mc:
          - isSR_2lOS
          - isAR_2lOS
      - lepton_category: 3l
        lepton_flavors:
        - eee
        - eem
        - emm
        - mmm
        region_definitions:
        - name: 3l_onZ_1b
          channel: 3l
          subchannel: 3l_onZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz_wtau
            - tau0pt
        - name: 3l_onZ_2b
          channel: 3l
          subchannel: 3l_onZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz_wtau
            - tau0pt
        - name: 3l_m_offZ_1b
          channel: 3l_m
          subchannel: 3l_offZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_m_offZ_2b
          channel: 3l_m
          subchannel: 3l_offZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_p_offZ_1b
          channel: 3l_p
          subchannel: 3l_offZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_p_offZ_2b
          channel: 3l_p
          subchannel: 3l_offZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_1tau_1b
          tags:
          - bmask_exactly1m
          - 1tau
          histogram_variables:
            exclude:
            - ptz
        - name: 3l_1tau_2b
          tags:
          - bmask_atleast2m
          - 1tau
          histogram_variables:
            exclude:
            - ptz
        jet_bins:
        - =2
        - =3
        - =4
        - '>5'
        application_tags:
          mc:
          - isSR_3l
          - isAR_3l
      - lepton_category: 4l
        lepton_flavors:
        - llll
        region_definitions:
        - name: 4l
          channel: 4l
          tags:
          - bmask_atleast1m2l
        jet_bins:
        - =2
        - =3
        - '>4'
        histogram_variables:
          exclude:
          - ptz
          - ptz_wtau
          - tau0pt
        application_tags:
          mc:
          - isSR_4l
    TAU_CH_LST_CR:
      description: Control regions supporting the tau-enhanced analysis.
      scenarios:
      - tau_analysis
      regions:
      - lepton_category: 2los_1tau
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2los_1tau_Ftau
          channel: 2los
          subchannel: 2l_nozeeveto
          tags:
          - bmask_atleast1m2l
          - 1Ftau
        - name: 2los_1tau_Ttau
          channel: 2los
          subchannel: 2l_nozeeveto
          tags:
          - bmask_atleast1m2l
          - 1tau
        jet_bins:
        - =2
        - =3
        - =4
        histogram_variables:
          exclude:
          - j0pt
          - j0eta
          - o0pt
          - b0pt
          - bl0pt
        application_tags:
          mc:
          - isSR_2lOS
      - lepton_category: 1l_1tau_CR
        lepton_flavors:
        - e
        - m
        region_definitions:
        - name: 1l_1tau_CR
          channel: 1l
          tags:
          - bmask_atleast2m
          - 1tau
        jet_bins:
        - =2
        - =3
        - =4
        histogram_variables:
          exclude:
          - j0pt
          - j0eta
          - o0pt
          - b0pt
          - bl0pt
        application_tags:
          mc:
          - isSR_1l
    TOP22_006_CH_LST_SR:
      description: Baseline Run 2 ttH multilepton signal regions used in the TOP-22-006
        reinterpretation. Regions are organised by lepton multiplicity with jet binning
        and application tags derived from the legacy ``ch_lst.json`` lists and consolidated
        here for metadata-driven configuration.
      scenarios:
      - TOP_22_006
      regions:
      - lepton_category: 2l
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2lss_p
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - bmask_atmost2m
          - 0tau
        - name: 2lss_m
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - bmask_atmost2m
          - 0tau
        - name: 2lss_4t_p
          channel: 2lss
          subchannel: 2l_p
          tags:
          - bmask_atleast1m2l
          - bmask_atleast3m
          - 0tau
        - name: 2lss_4t_m
          channel: 2lss
          subchannel: 2l_m
          tags:
          - bmask_atleast1m2l
          - bmask_atleast3m
          - 0tau
        jet_bins:
        - =4
        - =5
        - =6
        - '>7'
        histogram_variables:
          exclude:
          - ptz
          - ptz_wtau
          - tau0pt
        application_tags:
          mc:
          - isSR_2lSS
          - isAR_2lSS
          data:
          - isAR_2lSS_OS
      - lepton_category: 3l
        lepton_flavors:
        - eee
        - eem
        - emm
        - mmm
        region_definitions:
        - name: 3l_onZ_1b
          channel: 3l
          subchannel: 3l_onZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz_wtau
            - tau0pt
        - name: 3l_onZ_2b
          channel: 3l
          subchannel: 3l_onZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz_wtau
            - tau0pt
        - name: 3l_m_offZ_1b
          channel: 3l_m
          subchannel: 3l_offZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_m_offZ_2b
          channel: 3l_m
          subchannel: 3l_offZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_p_offZ_1b
          channel: 3l_p
          subchannel: 3l_offZ
          tags:
          - bmask_exactly1m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        - name: 3l_p_offZ_2b
          channel: 3l_p
          subchannel: 3l_offZ
          tags:
          - bmask_atleast2m
          - 0tau
          histogram_variables:
            exclude:
            - ptz
            - ptz_wtau
            - tau0pt
        jet_bins:
        - =2
        - =3
        - =4
        - '>5'
        application_tags:
          mc:
          - isSR_3l
          - isAR_3l
      - lepton_category: 4l
        lepton_flavors:
        - llll
        region_definitions:
        - name: 4l
          channel: 4l
          tags:
          - bmask_atleast1m2l
          - 0tau
        jet_bins:
        - =2
        - =3
        - '>4'
        histogram_variables:
          exclude:
          - ptz
          - ptz_wtau
          - tau0pt
        application_tags:
          mc:
          - isSR_4l
    OFFZ_SPLIT_CH_LST_SR:
      description: Alternative signal-region grouping with finer off-Z splitting for
        the trilepton channel.
      features:
      - offz_split
      scenarios:
      - TOP_22_006
      regions:
      - lepton_category: 3l
        lepton_flavors:
        - eee
        - eem
        - emm
        - mmm
        region_definitions:
        - name: 3l_m_offZ_low_1b
          channel: 3l_m
          subchannel: 3l_offZ_low
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_m_offZ_high_1b
          channel: 3l_m
          subchannel: 3l_offZ_high
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_m_offZ_none_1b
          channel: 3l_m
          subchannel: 3l_offZ_none
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
          histogram_variables:
            exclude:
            - ptz
        - name: 3l_m_offZ_low_2b
          channel: 3l_m
          subchannel: 3l_offZ_low
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_m_offZ_high_2b
          channel: 3l_m
          subchannel: 3l_offZ_high
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_m_offZ_none_2b
          channel: 3l_m
          subchannel: 3l_offZ_none
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
          histogram_variables:
            exclude:
            - ptz
        - name: 3l_p_offZ_low_1b
          channel: 3l_p
          subchannel: 3l_offZ_low
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_p_offZ_high_1b
          channel: 3l_p
          subchannel: 3l_offZ_high
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_p_offZ_none_1b
          channel: 3l_p
          subchannel: 3l_offZ_none
          tags:
          - bmask_exactly1m
          - 0tau
          - ~fwdjet_mask
          histogram_variables:
            exclude:
            - ptz
        - name: 3l_p_offZ_low_2b
          channel: 3l_p
          subchannel: 3l_offZ_low
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_p_offZ_high_2b
          channel: 3l_p
          subchannel: 3l_offZ_high
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
        - name: 3l_p_offZ_none_2b
          channel: 3l_p
          subchannel: 3l_offZ_none
          tags:
          - bmask_atleast2m
          - 0tau
          - ~fwdjet_mask
          histogram_variables:
            exclude:
            - ptz
        histogram_variables:
          exclude:
          - ptz_wtau
          - tau0pt
        jet_bins:
        - =2
        - =3
        - =4
        - '>5'
        application_tags:
          mc:
          - isSR_3l
          - isAR_3l
    CH_LST_CR:
      description: Shared control regions for fake, charge-flip, and validation studies.
      scenarios:
      - TOP_22_006
      - tau_analysis
      - fwd_analysis
      regions:
      - lepton_category: 2l_CR
        lepton_flavors:
        - ee
        - em
        - mm
        region_definitions:
        - name: 2lss_CR
          channel: chargedl0
          subchannel: 2lss
          tags:
          - bmask_exactly1m
        jet_bins:
        - =1
        - =2
        - =3
        application_tags:
          mc:
          - isSR_2lSS
          - isAR_2lSS
          data:
          - isAR_2lSS_OS
      - lepton_category: 2l_CRflip
        lepton_flavors:
        - ee
        region_definitions:
        - name: 2lss_CRflip
          channel: 2l_nozeeveto
          subchannel: 2lee
          tags:
          - 2l_onZ_as
        jet_bins:
        - <3
        application_tags:
          mc:
          - isSR_2lSS
          - isAR_2lSS
          data:
          - isAR_2lSS_OS
      - lepton_category: 2los_CRZ
        lepton_flavors:
        - ee
        - mm
        region_definitions:
        - name: 2los_CRZ
          channel: 2l_nozeeveto
          subchannel: 2los
          tags:
          - 2l_onZ
          - bmask_exactly0m
        jet_bins:
        - '>0'
        histogram_variables:
          exclude:
          - ptz
          - j0pt
          - j0eta
          - o0pt
          - b0pt
          - bl0pt
          - ptz_wtau
          - tau0pt
        application_tags:
          mc:
          - isSR_2lOS
          - isAR_2lOS
      - lepton_category: 2los_CRtt
        lepton_flavors:
        - em
        region_definitions:
        - name: 2los_CRtt
          channel: 2l_nozeeveto
          subchannel: 2los
          tags:
          - 2lem
          - bmask_exactly2m
        jet_bins:
        - =2
        application_tags:
          mc:
          - isSR_2lOS
      - lepton_category: 3l_CR
        lepton_flavors:
        - eee
        - eem
        - emm
        - mmm
        region_definitions:
        - name: 3l_CR
          channel: 3l
          tags:
          - bmask_exactly0m
        jet_bins:
        - =0
        - '>1'
        application_tags:
          mc:
          - isSR_3l
          - isAR_3l
variables:
  ptz_wtau:
    regular:
    - 12
    - 0
    - 600
    variable:
    - 0
    - 150
    - 250
    - 500
    label: 'pt of lepton hadronic tau pair (GeV) '
    definition: ptz_wtau
  tau0pt:
    regular:
    - 12
    - 0
    - 600
    variable:
    - 0
    - 150
    - 250
    - 500
    label: 'pt of leading hadronic tau (GeV) '
    definition: tau0.pt
systematics:
  nominal:
    type: nominal
    applies_to:
    - all
    variations:
    - value: nominal
